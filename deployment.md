# Инструкция по развертыванию на Netlify

## Шаг 1: Развертывание правил Firestore

Перед развертыванием на Netlify **обязательно** обновите правила Firestore:

1. Откройте [Firebase Console](https://console.firebase.google.com/)
2. Выберите проект **projectman-96d3c**
3. Перейдите в **Firestore Database** → **Rules**
4. Скопируйте содержимое файла `firestore.rules` и вставьте в редактор
5. Нажмите **Publish**

## Шаг 2: Развертывание на Netlify

### Вариант A: Через веб-интерфейс (Рекомендуется)

1. Откройте [Netlify](https://app.netlify.com/)
2. Перейдите на страницу вашего сайта
3. Перейдите в **Deploys** → **Deploy manually**
4. Перетащите папку проекта в зону загрузки

**Файлы для загрузки:**
- `index.html`
- `style.css`
- `mobile-additions.css`
- `script.js`
- `netlify.toml` (ОБЯЗАТЕЛЬНО для корректной работы ссылок)
- `_headers` (ОБЯЗАТЕЛЬНО для правильного кэширования)
- (НЕ загружайте `firestore.rules`, `firebase.json`, `README.md`, `*.md` файлы)

**Важно про обновления:** 
- Обновления работают через **версионирование в URL** (`?v=1.9`)
- При изменении кода меняйте номер версии в `index.html`
- Подробная инструкция в **SIMPLE_UPDATE_GUIDE.md**
- Пользователи получат обновление автоматически при обновлении страницы (F5)

### Вариант B: Через Netlify CLI

```bash
# Установите Netlify CLI (если еще не установлен)
npm install -g netlify-cli

# Войдите в Netlify
netlify login

# Разверните сайт
netlify deploy --prod
```

## Шаг 3: Проверка

1. Откройте ваш сайт на Netlify
2. Войдите с email и паролем
3. Выберите роль (Admin требует пароль 301098)
4. Закройте браузер и откройте снова
5. ✅ Вы должны автоматически войти и увидеть экран выбора роли

## Важные замечания

- **Роль не сохраняется** - это нормально и сделано для безопасности
- **Email/пароль сохраняются** - Firebase Auth автоматически входит при следующем посещении
- **Для смены роли** - просто перезагрузите страницу
- **Для полного выхода** - нажмите кнопку "Выйти" в боковой панели

## Устранение неполадок

**Проблема**: Не могу войти автоматически
- Убедитесь, что Firestore Rules развернуты
- Проверьте консоль браузера на наличие ошибок

**Проблема**: Ошибка "Permission denied"
- Firestore Rules не развернуты или развернуты неправильно
- Перепроверьте правила в Firebase Console

**Проблема**: Приходится каждый раз вводить email/пароль
- Проверьте, что cookies не блокируются браузером
- Убедитесь, что не используете режим инкогнито

---

## Обновление приложения (для разработчиков)

### Автоматическое обновление для пользователей

Приложение **автоматически обновляется** у всех пользователей благодаря:
1. **Мета-тегам в HTML** - браузер всегда загружает свежий `index.html`
2. **Файлу `_headers`** - Netlify правильно настраивает кэширование
3. **Версионированию JS/CSS** - при изменении кода меняем `?v=1.8` на `?v=1.9`

### Как выпустить обновление:

1. **Внесите изменения** в `script.js`, `style.css` или другие файлы
2. **Обновите версию** в `index.html`:
   ```html
   <!-- Было -->
   <script src="/script.js?v=1.8" defer></script>
   
   <!-- Стало -->
   <script src="/script.js?v=1.9" defer></script>
   ```
3. **Загрузите на Netlify** все файлы (включая `_headers`)
4. **Готово!** Пользователи автоматически получат обновление в течение 1-2 минут

### Пользователям НЕ нужно:
- ❌ Очищать кэш вручную
- ❌ Нажимать Ctrl+F5
- ❌ Переустанавливать приложение
- ✅ Просто обновить страницу (F5) или зайти заново

### Текущая версия
Узнать текущую версию можно в консоли браузера (F12):
```javascript
// Откройте консоль и введите:
console.log("Script version:", document.querySelector('script[src*="script.js"]').src);
```

### Почему это работает:
- **HTML не кэшируется** → браузер всегда получает актуальный файл с новыми версиями JS/CSS
- **JS/CSS кэшируются** → но только пока версия в URL не изменится
- **Изменили `?v=1.8` на `?v=1.9`** → браузер считает это новым файлом и загружает его
